<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pandoo App - Advanced Revenue Projection</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary-color: #4A90E2;
            --secondary-color: #F5A623;
            --success-color: #28a745;
            --bg-color: #f4f7f6;
            --font-color: #333;
            --card-bg: #ffffff;
            --border-color: #e0e0e0;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--font-color);
            margin: 0;
            padding: 20px;
        }
        .container {
            max-width: 1200px;
            margin: auto;
            padding: 20px;
        }
        header {
            text-align: center;
            margin-bottom: 40px;
        }
        header h1 {
            color: var(--primary-color);
            margin-bottom: 10px;
        }
        .controls {
            display: flex;
            justify-content: space-around;
            align-items: center;
            background: var(--card-bg);
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        .input-group {
            display: flex;
            flex-direction: column;
            margin: 10px;
        }
        .input-group label {
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 0.9em;
        }
        .input-group input, .input-group select {
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            font-size: 1em;
            width: 200px;
        }
        .summary-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 40px;
        }
        .summary-box {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .summary-box h3 {
            margin: 0 0 10px 0;
            font-size: 1em;
            font-weight: 600;
            color: #555;
        }
        .summary-box .value {
            font-size: 2.2em;
            font-weight: 700;
        }
        #totalUsersValue { color: var(--primary-color); }
        #totalRevenueValue { color: var(--success-color); }

        .assumptions-display {
            background-color: #e7f3fe;
            border-left: 5px solid var(--primary-color);
            padding: 15px 20px;
            margin-bottom: 40px;
            border-radius: 0 8px 8px 0;
        }
        .assumptions-display h3 {
            margin-top: 0;
            color: var(--primary-color);
        }
        .assumptions-display ul {
            padding-left: 20px;
            margin-bottom: 0;
        }
        .assumptions-display li {
            margin-bottom: 10px;
            line-height: 1.5;
        }
        .charts-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 40px;
        }
        .chart-wrapper {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .chart-wrapper h3 {
            text-align: center;
            margin-bottom: 20px;
        }
        .table-container {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            overflow-x: auto;
        }
        .table-container h2 {
            text-align: center;
            margin-bottom: 20px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }
        th {
            background-color: var(--primary-color);
            color: white;
            font-weight: 600;
        }
        tbody tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        tbody tr:hover {
            background-color: #f1f1f1;
        }

        @media (max-width: 768px) {
            .controls, .charts-container, .summary-container {
                flex-direction: column;
                grid-template-columns: 1fr;
            }
            .input-group { width: 100%; }
            .input-group input, .input-group select {
                width: 100%;
                box-sizing: border-box;
            }
        }
    </style>
</head>
<body>

    <div class="container">
        <header>
            <h1>Pandoo App Revenue Projection</h1>
            <p>Adjust the inputs below to see the projection change dynamically with a realistic growth model.</p>
        </header>

        <div class="controls">
            <div class="input-group">
                <label for="somNumber">Total SOM</label>
                <input type="number" id="somNumber" value="228000">
            </div>
            <div class="input-group">
                <label for="somPercent">Obtainable Market (%)</label>
                <input type="number" id="somPercent" value="10" min="1" max="100">
            </div>
            <div class="input-group">
                <label for="duration">Projection Duration</label>
                <select id="duration">
                    <option value="12">12 Months</option>
                    <option value="24" selected>24 Months</option>
                    <option value="36">36 Months</option>
                    <option value="48">48 Months</option>
                    <option value="60">60 Months</option>
                </select>
            </div>
        </div>

        <div class="summary-container">
            <div class="summary-box">
                <h3>Total Users Acquired</h3>
                <span id="totalUsersValue" class="value">0</span>
            </div>
            <div class="summary-box">
                <h3>Total Projected Revenue</h3>
                <span id="totalRevenueValue" class="value">$0</span>
            </div>
        </div>

        <div class="assumptions-display">
            <h3>Core Assumptions</h3>
            <ul>
                <li><b>Initial Subscription Mix:</b> 50% of new users choose the Monthly ($10) plan, 10% choose the Half-Yearly ($48) plan, and 40% choose the Yearly ($60) plan.</li>
                <li><b>Revenue Recognition:</b> Revenue from new subscribers is booked in the month of purchase. The initial revenue for monthly subscribers is calculated as <strong>$30</strong> to reflect an average 3-month duration.</li>
                <li><b>Growth Model:</b> New user acquisition follows a unique, non-linear S-curve that adapts to the selected projection duration to simulate a realistic product lifecycle.</li>
            </ul>
        </div>


        <div class="charts-container">
            <div class="chart-wrapper">
                <h3>New Paid Users Over Time</h3>
                <canvas id="usersChart"></canvas>
            </div>
            <div class="chart-wrapper">
                <h3>Cumulative Revenue Over Time</h3>
                <canvas id="revenueChart"></canvas>
            </div>
        </div>


        <div class="table-container">
             <h2>Monthly Projection Data</h2>
            <table>
                <thead>
                    <tr>
                        <th>Month</th>
                        <th>New Paid Users</th>
                        <th>New Monthly Subs</th>
                        <th>New Half-Yearly Subs</th>
                        <th>New Yearly Subs</th>
                        <th>Total Monthly Revenue</th>
                        <th>Cumulative Revenue</th>
                    </tr>
                </thead>
                <tbody id="projectionTableBody">
                    </tbody>
            </table>
        </div>

    </div>

    <script>
        // --- DOM ELEMENTS ---
        const somNumberInput = document.getElementById('somNumber');
        const somPercentInput = document.getElementById('somPercent');
        const durationSelect = document.getElementById('duration');
        const tableBody = document.getElementById('projectionTableBody');
        const usersChartCanvas = document.getElementById('usersChart');
        const revenueChartCanvas = document.getElementById('revenueChart');
        const totalUsersValue = document.getElementById('totalUsersValue');
        const totalRevenueValue = document.getElementById('totalRevenueValue');

        // --- CHART INSTANCES ---
        let usersChartInstance;
        let revenueChartInstance;

        // --- CORE ASSUMPTIONS ---
        const assumptions = {
            subscriptionMix: { monthly: 0.50, halfYearly: 0.10, yearly: 0.40 },
            revenue: { monthly: 30, halfYearly: 48, yearly: 60 },
            renewal: { rate: 0.50, avgValue: 57.6 },
            randomnessFactor: 0.20 // +/- 10% variance
        };

        // --- DYNAMIC GROWTH PATTERNS ---
        function getMonthlyGrowthPattern(totalMonths) {
            const normalize = (arr) => {
                const sum = arr.reduce((a, b) => a + b, 0);
                return arr.map(v => v / sum);
            };

            // 12 Months: Launch and rapid growth phase
            if (totalMonths === 12) return normalize([2, 3, 4, 6, 8, 10, 12, 13, 12, 11, 10, 9]);
            
            // 24 Months: A full, classic S-Curve
            if (totalMonths === 24) return normalize([2, 2, 3, 3, 4, 5, 6, 8, 10, 12, 13, 12, 11, 10, 9, 8, 7, 6, 5, 5, 4, 4, 11, 12]);

            // 36 Months: S-Curve followed by a stable plateau
            if (totalMonths === 36) return normalize([2, 2, 3, 3, 4, 5, 6, 8, 10, 12, 13, 12, 11, 10, 9, 8, 7, 6, 6, 6, 6, 5, 5, 5, 5, 4, 4, 4, 6, 8, 4, 11, 12, 13, 13, 12, 13]);

            // 48 Months: S-Curve with a longer plateau and slight decline
            if (totalMonths === 48) return normalize([2, 2, 3, 3, 4, 5, 6, 8, 10, 12, 13, 12, 11, 10, 9, 8, 7, 6, 6, 6, 6, 5, 5, 5, 5, 4, 4, 4, 4, 4, 4, 4, 4, 4, 3, 3, 4, 6, 3, 3, 3, 5, 7, 8, 11, 12, 12, 13]);

            // 60 Months: Full lifecycle with saturation and decay
            if (totalMonths === 60) return normalize([2, 2, 3, 3, 4, 5, 6, 8, 10, 12, 13, 12, 11, 10, 9, 8, 7, 6, 6, 6, 6, 5, 5, 5, 5, 4, 4, 4, 4, 4, 4, 4, 4, 4, 3, 7, 3, 3, 5, 7, 6, 3, 3, 3, 8, 6, 5, 8, 2, 6, 4, 5, 6, 10, 11, 11, 12, 12, 12, 13]);

            // Default fallback
            return new Array(totalMonths).fill(1/totalMonths);
        }


        // --- EVENT LISTENERS ---
        [somNumberInput, somPercentInput, durationSelect].forEach(element => {
            element.addEventListener('change', generateAndRender);
        });

        // --- MAIN GENERATION FUNCTION ---
        function generateProjectionData() {
            const somNumber = parseFloat(somNumberInput.value);
            const somPercent = parseFloat(somPercentInput.value) / 100;
            const totalMonths = parseInt(durationSelect.value);

            const totalTargetUsers = somNumber * somPercent;
            const growthPattern = getMonthlyGrowthPattern(totalMonths);
            
            const projectionData = [];
            let cumulativeRevenue = 0;
            const yearlyUserAcquisition = {};

            for (let month = 1; month <= totalMonths; month++) {
                const currentYear = Math.ceil(month / 12);
                
                // --- 1. Calculate New Users with adaptive S-Curve Model ---
                const baseNewUsers = totalTargetUsers * growthPattern[month - 1];
                const fluctuation = (Math.random() - 0.5) * assumptions.randomnessFactor;
                const newUsersThisMonth = Math.max(0, Math.round(baseNewUsers * (1 + fluctuation)));
            
                if (!yearlyUserAcquisition[currentYear]) yearlyUserAcquisition[currentYear] = 0;
                yearlyUserAcquisition[currentYear] += newUsersThisMonth;

                // --- 2. Calculate Subscription Split ---
                const newMonthlySubs = Math.round(newUsersThisMonth * assumptions.subscriptionMix.monthly);
                const newHalfYearlySubs = Math.round(newUsersThisMonth * assumptions.subscriptionMix.halfYearly);
                const newYearlySubs = Math.round(newUsersThisMonth * assumptions.subscriptionMix.yearly);

                // --- 3. Calculate Revenue ---
                const revenueFromNewUsers = (newMonthlySubs * assumptions.revenue.monthly) +
                                          (newHalfYearlySubs * assumptions.revenue.halfYearly) +
                                          (newYearlySubs * assumptions.revenue.yearly);
                
                let renewalRevenue = 0;
                if (month > 12) {
                    const previousYear = currentYear - 1;
                    const usersToRenewFrom = yearlyUserAcquisition[previousYear] || 0;
                    renewalRevenue = (usersToRenewFrom * assumptions.renewal.rate * assumptions.renewal.avgValue) / 12;
                }
                
                const totalMonthlyRevenue = revenueFromNewUsers + renewalRevenue;
                cumulativeRevenue += totalMonthlyRevenue;
                
                projectionData.push({
                    month,
                    newUsersThisMonth,
                    newMonthlySubs,
                    newHalfYearlySubs,
                    newYearlySubs,
                    totalMonthlyRevenue,
                    cumulativeRevenue
                });
            }
            return projectionData;
        }

        // --- RENDER FUNCTIONS ---
        function renderTable(data) {
            tableBody.innerHTML = ''; // Clear previous data
            const formatter = new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' });
            
            data.forEach(d => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${d.month}</td>
                    <td>${d.newUsersThisMonth.toLocaleString()}</td>
                    <td>${d.newMonthlySubs.toLocaleString()}</td>
                    <td>${d.newHalfYearlySubs.toLocaleString()}</td>
                    <td>${d.newYearlySubs.toLocaleString()}</td>
                    <td>${formatter.format(d.totalMonthlyRevenue)}</td>
                    <td>${formatter.format(d.cumulativeRevenue)}</td>
                `;
                tableBody.appendChild(row);
            });
        }
        
        function renderSummary(data) {
            const totalUsers = data.reduce((sum, d) => sum + d.newUsersThisMonth, 0);
            const totalRevenue = data.length > 0 ? data[data.length - 1].cumulativeRevenue : 0;
            const formatter = new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' });
            
            totalUsersValue.textContent = totalUsers.toLocaleString();
            totalRevenueValue.textContent = formatter.format(totalRevenue);
        }

        function renderCharts(data) {
            const labels = data.map(d => `Month ${d.month}`);
            const newUsersData = data.map(d => d.newUsersThisMonth);
            const cumulativeRevenueData = data.map(d => d.cumulativeRevenue);
            
            if (usersChartInstance) usersChartInstance.destroy();
            if (revenueChartInstance) revenueChartInstance.destroy();
            
            usersChartInstance = new Chart(usersChartCanvas, {
                type: 'line',
                data: {
                    labels,
                    datasets: [{
                        label: 'New Paid Users',
                        data: newUsersData,
                        borderColor: 'rgba(74, 144, 226, 1)',
                        backgroundColor: 'rgba(74, 144, 226, 0.2)',
                        fill: true,
                        tension: 0.4
                    }]
                }
            });

            revenueChartInstance = new Chart(revenueChartCanvas, {
                type: 'line',
                data: {
                    labels,
                    datasets: [{
                        label: 'Cumulative Revenue',
                        data: cumulativeRevenueData,
                        borderColor: 'rgba(40, 167, 69, 1)',
                        backgroundColor: 'rgba(40, 167, 69, 0.2)',
                        fill: true,
                        tension: 0.4
                    }]
                }
            });
        }

        // --- INITIALIZATION ---
        function generateAndRender() {
            const data = generateProjectionData();
            renderTable(data);
            renderCharts(data);
            renderSummary(data);
        }
        
        generateAndRender();
    </script>
</body>
</html>